# PDF2KG 版本历史

## V0 - 基础版本 (当前)

### 功能
- ✅ PDF 文本提取
- ✅ 文本分块处理
- ✅ DeepSeek API 提取实体和关系
- ✅ 多线程并发处理
- ✅ 磁盘缓存
- ✅ NetworkX 可视化
- ✅ Neo4j 存储

### 已知问题
- 实体提取不够准确
- 关系类型过于简单
- 图谱结构松散
- 缺少实体消歧
- 缺少关系验证

### 输出
- `output/kg_batch.json` - 知识图谱数据
- `output/kg_batch.png` - 可视化图片 (V0)

---

## 迭代计划

这是一个基于 V0 原型，集成 `bge-m3` 和 `faiss`，并重点优化并行性能与评测的任务列表。

### V1 - 并行化改造与向量集成
**目标**：将串行代码改为“生产者-消费者”模式，引入向量模型。

*   [ ] **1.1 引入 bge-m3 模型**
    *   在项目中加载 `BAAI/bge-m3`。
    *   编写函数：输入文本列表，输出 Dense Vectors（稠密向量）。
*   [ ] **1.2 建立 FAISS 索引**
    *   初始化一个 FAISS Index（如 `Flat`）。（建议使用 CPU 友好的 `Flat` 索引，等到时候数据规模大了再用 GPU）
    *   用于存储文本块的向量，供后续检索使用。
*   [ ] **1.3 实现并行流水线 (Pipeline)**
    *   利用 `multiprocessing.Queue` 创建三个队列。
    *   **Worker 1 (PDF解析)**：读取 PDF，切分文本，放入队列 A。
    *   **Worker 2 (向量计算)**：从队列 A 批量读取文本（Batch Size=32），调用 bge-m3 计算向量，存入 FAISS，文本放入队列 B。
    *   **Worker 3 (实体提取)**：从队列 B 读取文本，使用多线程（Thread Pool）并发调用 DeepSeek API，结果存入 Neo4j 数据库。

### V2 - 实体对齐 (数据清洗)
**目标**：利用向量相似度解决实体重复问题（如“Transformer”与“变形金刚”）。
也许我们可以统一到中文，现在是中英文混杂的，我的思路是先对中文内部做一次消歧，然后再做一次中英文的对齐。
*   [ ] **2.1 实体向量化**
    *   提取出新实体时，调用 bge-m3 计算该实体的向量。
*   [ ] **2.2 相似度消歧**
    *   在插入新实体前，在 FAISS 中检索 Top-1 相似实体。
    *   若相似度 > 0.85（阈值），则复用已有实体的 ID，不创建新节点。
    *   若相似度低，则创建新节点并更新索引。

### V3 - 自动化评测 (Benchmark)
**目标**：构建测试集，对比“纯向量检索”与“图增强检索”的效果。

*   [ ] **3.1 准备测试集**
    *   人工编写 20-30 个基于 PDF 内容的问题（Q）和标准答案（A）。
*   [ ] **3.2 构建 Baseline (纯向量)**
    *   实现检索逻辑：用户提问 -> bge-m3 编码 -> FAISS 搜 Top-3 文本块 -> deepseek-r1:1.5b 回答。
*   [ ] **3.3 构建 Ours (图增强)**
    *   实现检索逻辑：用户提问 -> 搜 Top 文本 -> **查询图谱关联节点 (1-hop)** -> 组合上下文 -> deepseek-r1:1.5b 回答。
*   [ ] **3.4 自动评分脚本**
    *   编写脚本，调用高阶 LLM（如 DeepSeek-V3）作为裁判。
    *   输入：标准答案、Baseline 回答、Ours 回答。
    *   输出：打分（1-5分）及胜负判断。

### V4 - 前端演示与展示
**目标**：可视化流水线效率与问答结果。

*   [ ] **4.1 搭建界面**
    *   包含文件上传区域。
    *   添加三个实时进度条，分别对应 V1 中的解析、向量化、提取进度，直观展示并行速度。
*   [ ] **4.2 问答交互区**
    *   集成 `deepseek-r1:1.5b` (Ollama)。
    *   用户提问后，显示：1. 检索到的文本块；2. 检索到的图关系；3. 最终回答。
*   [ ] **4.3 产出汇报材料**
    *   绘制"流水线并行架构图"。
    *   统计 V3 的评测数据，制作"准确率对比柱状图"。

---

## 最终交付

### PPT 汇报
使用 LaTeX Beamer 制作项目汇报 PPT，推荐使用武汉大学 Beamer 模板：

**模板地址**: https://github.com/FlorianTseng/WHU-Beamer

**汇报内容建议**：
1. **项目背景与目标**
   - PDF 知识图谱构建的意义
   - 技术路线选择

2. **系统架构**
   - 流水线并行架构图（V1）
   - 各模块功能说明

3. **核心技术**
   - 实体提取与关系构建
   - 向量检索与实体消歧（V2）
   - 图增强检索方案（V3）

4. **实验评测**
   - 准确率对比柱状图
   - 性能提升数据
   - 案例展示

5. **前端演示**
   - 界面截图
   - 问答交互示例

6. **总结与展望**
   - 项目成果
   - 未来改进方向
